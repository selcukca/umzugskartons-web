<?php


// +----------------------------------------------------------------------+
// | routeInfo                                                            |
// +----------------------------------------------------------------------+
if ($routeInfo["404"]) {

    // +----------------------------------------------------------------------+
    // |                                                                      |
    // +----------------------------------------------------------------------+
    if ($oRewrite = \Cnx\Db\Table::factory($DB, TB_REWRITE_URL)->subscribe(HTTP_HOST . WWW_HOME_DIR, HTTP_HOST . WWW_SCRIPT_DIR . WWW_ARGV)) {
        $oRewrite->redirect(HTTP_HOST . WWW_PROJECT_HOME_DIR);
    }

    // +----------------------------------------------------------------------+
    // | send header                                                          |
    // +----------------------------------------------------------------------+
    header("HTTP/1.1 404 Not Found");


    // +----------------------------------------------------------------------+
    // | get 404 page                                                                     |
    // +----------------------------------------------------------------------+
    if ($element = $STRUCTURE["PAGE_404"]) {
        $ROUTE = $element;
    }


}



// +----------------------------------------------------------------------+
// | INC_SCRIPT_DIR                                                       |
// +----------------------------------------------------------------------+
$INC_SCRIPT_DIR = dirname(__FILE__) . "/";



// +----------------------------------------------------------------------+
// | structure/route exists?                                              |
// +----------------------------------------------------------------------+
if ($ROUTE) {


    // +----------------------------------------------------------------------+
    // | meta                                                                 |
    // +----------------------------------------------------------------------+
    foreach (array("title", "keywords", "description", "robots", "author") as $column) {
        if (!empty($ROUTE->lang->{$column})) {
            $PAGE["meta"][$column]                    = $ROUTE->lang->{$column};
            $PAGE["meta"]["facebook"]["og:{$column}"] = $ROUTE->lang->{$column};
        }
    }


    // +----------------------------------------------------------------------+
    // | title                                                                |
    // +----------------------------------------------------------------------+
    $PAGE["title"] = $ROUTE->lang->title;


    // +----------------------------------------------------------------------+
    // | head                                                                 |
    // +----------------------------------------------------------------------+
    if (!empty($ROUTE->lang->header)) {
        $PAGE["head"] = $ROUTE->lang->header;
    }

    // +----------------------------------------------------------------------+
    // | load datatype                                                        |
    // +----------------------------------------------------------------------+
    try {

        if (file_exists($incFile = $INC_SCRIPT_DIR . "{$ROUTE->datatype->data->ident}.preload.inc.php")) {
            include($incFile);
        } else {
            include($INC_SCRIPT_DIR . "standard.preload.inc.php");
        }


    } catch (\Exception $oEx) {

        //\Cnx\Debugger::emerg($oEx, __FILE__, __LINE__);
    }


}
