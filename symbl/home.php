<?php

// +----------------------------------------------------------------------+
// |                                                                      |
// +----------------------------------------------------------------------+
ob_start("ob_gzhandler");


// +----------------------------------------------------------------------+
// | REWRITE ENGINE                                                       |
// +----------------------------------------------------------------------+
// | see .htaccess: SetEnv REWRITE_ENGINE 1                               |
// +----------------------------------------------------------------------+
define("REWRITE_ENGINE", false);//   (isset($_SERVER["REWRITE_ENGINE"]))? (bool)$_SERVER["REWRITE_ENGINE"] : true);


// +----------------------------------------------------------------------+
// | project name                                                         |
// +----------------------------------------------------------------------+
// | scripts are under "content/frontend/"                                |
// +----------------------------------------------------------------------+
define("PROJECT_NAME",      "frontend");


// +----------------------------------------------------------------------+
// | REAL_PROJECT_NAME                                                    |
// +----------------------------------------------------------------------+
// | which frontend?                                                      |
// +----------------------------------------------------------------------+
require_once("init.project.inc.php");


// +----------------------------------------------------------------------+
// | session handling                                                     |
// +----------------------------------------------------------------------+
require_once("session.start.inc.php");


// +----------------------------------------------------------------------+
// | load configuration                                                   |
// +----------------------------------------------------------------------+
require_once("init.inc.php");


// +----------------------------------------------------------------------+
// | load framework                                                       |
// +----------------------------------------------------------------------+
include("framework.inc.php");




// +----------------------------------------------------------------------+
// | Suche                                                                |
// +----------------------------------------------------------------------+
// | only if not 404, ... ($routeInfo)                                    |
// +----------------------------------------------------------------------+
if (array_sum($routeInfo) == 0) {


    try {


        if ($oSearch = \Cnx\Db\Table::factory($DB, TB_SEARCHDATA)->subscribe(HTTP_HOST . WWW_HOME_DIR, HTTP_HOST . WWW_SCRIPT_DIR . WWW_ARGV, $html, LANG_ID, $ROUTE? $ROUTE->getId() : null, $PAGE)) {

            $oSearch->save(false);

        }

    } catch (\Exception $oEx) {
        \Cnx\Debugger::err($oEx, __FILE__, __LINE__, $oDB->last_query);
    }

}
